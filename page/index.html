<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Happy-service</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
      * {
        padding: 0px;
        margin: 0px;
      }
      ul {
        width: 96vw;
        padding: 0 20px 20px 20px;
        border: 5px dashed forestgreen;
        box-sizing: border-box;
        margin: 0 auto;
        height: 100vh;
        overflow-y: auto;
      }

      ul > li:nth-child(1) {
        top: 0px;
        position: sticky;
        background: #fff;
        font-weight: bold;
        padding: 10px 0px;
      }

      li {
        display: grid;
        width: 100%;
        grid-template-columns: 1fr 1fr;
        align-items: center;
        border-bottom: 1px solid forestgreen;
      }

      li span {
        width: 100%;
        display: inline-block;
        word-break: break-all;
        padding: 5px 0px;
      }

      li span:nth-child(2) {
        border-left: 1px solid forestgreen;
        padding-left: 10px;
      }

      .center {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <script>
      const apiQueryPatMap = "http://127.0.0.1:4000/happy-service";

      /** 将指定文本写入用户剪切板 */
      const writeTextToClipboard = (text, successCallback, errorCallback) => {
        if (!text) {
          alert("文本为空！");
          return;
        }

        if (navigator?.clipboard) {
          // clipboard api 复制
          navigator?.clipboard
            ?.writeText(text)
            .then(() => alert("复制成功！"))
            .catch((err) => alert("复制失败！"));
          return;
        }

        try {
          const textarea = document.createElement("textarea");
          document.body.appendChild(textarea);
          // 隐藏此输入框
          textarea.style.position = "fixed";
          textarea.style.clip = "rect(0 0 0 0)";
          textarea.style.top = "10px";
          // 赋值
          textarea.value = text;
          // 选中
          textarea.select();
          // 复制
          document.execCommand("copy", true);
          // 移除输入框
          document.body.removeChild(textarea);

          alert("复制成功！");
        } catch (error) {
          alert("复制失败！");
        }
      };

      // fetch(apiQueryPatMap)
      fetch(apiQueryPatMap, {
        method: "get",
        mode: "cors",
        cache: "no-cache",
        credentials: "same-origin",
        headers: {
          "Content-Type": "application/json",
        },
        redirect: "follow",
        referrerPolicy: "no-referrer",
      })
        .then((response) => response.json())
        .then((data) => {
          const ul = document.createElement("ul");

          let ulInnerHTML = `
            <li>
              <span class="center">接口</span>
              <span class="center">本地地址</span></span>
            </li>
          `;

          Object.entries(data).forEach(([key, value]) => {
            const liItem = `
              <li>
                <span>
                  ${key}
                  <button value="${key}">copy</button>
                </span>
                <span>
                  ${value}
                  <button value="${value}">copy</button>
                </span>
              </li>
            `;
            ulInnerHTML += liItem;
          });

          ul.innerHTML = ulInnerHTML;
          document.body.appendChild(ul);

          ul.addEventListener("click", (e) => {
            if (e.target.tagName.toLocaleLowerCase() !== "button") {
              return;
            }
            writeTextToClipboard(e.target.value);
          });
        });
    </script>
  </body>
</html>
